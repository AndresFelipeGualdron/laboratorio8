<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.cvds.sampleprj.dao.mybatis.mappers.ClienteMapper">

	<select parameterType="map" id="consultarClientes" resultMap="ClienteResult">
			select
		    c.nombre as nombreCliente,
		    c.documento as documentoCliente,
		    c.telefono as telefonoCliente,
		    c.direccion as direccionCliente,
		    c.email as emailCliente,
		    c.vetado as vetadoCliente,
		    ir.id as idItemRentado,
		    ir.fechainiciorenta as firItemRentado,
		    ir.fechafinrenta as ffrItemRentado,
		    i.id as idItem,
		    i.nombre as nombreItem,
		    i.descripcion as descripcionItem,
		    i.fechalanzamiento as fechaLanItem,
		    i.tarifaxdia as tarifaxdiaItem,
		    i.formatorenta as formatorentaItem,
		    i.genero as generoItem,        
		    ti.id as idTipoItem,
		    ti.descripcion as descripcionTipoItem
		    FROM VI_CLIENTES as c 
		    left join VI_ITEMRENTADO as ir on c.documento=ir.CLIENTES_documento 
		    left join VI_ITEMS as i on ir.ITEMS_id=i.id 
		    left join VI_TIPOITEM as ti on i.TIPOITEM_id=ti.id ;
	</select>
	
	<select parameterType="map" id="consultarCliente" resultMap="ClienteResult">
		select
		    c.nombre as nombreCliente,
		    c.documento as documentoCliente,
		    c.telefono as telefonoCliente,
		    c.direccion as direccionCliente,
		    c.email as emailCliente,
		    c.vetado as vetadoCliente,
		    ir.id as idItemRentado,
		    ir.fechainiciorenta as firItemRentado,
		    ir.fechafinrenta as ffrItemRentado,
		    i.id as idItem,
		    i.nombre as nombreItem,
		    i.descripcion as descripcionItem,
		    i.fechalanzamiento as fechaLanItem,
		    i.tarifaxdia as tarifaxdiaItem,
		    i.formatorenta as formatorentaItem,
		    i.genero as generoItem,        
		    ti.id as idTipoItem,
		    ti.descripcion as descripcionTipoItem
		    FROM VI_CLIENTES as c 
		    left join VI_ITEMRENTADO as ir on c.documento=ir.CLIENTES_documento 
		    left join VI_ITEMS as i on ir.ITEMS_id=i.id 
		    left join VI_TIPOITEM as ti on i.TIPOITEM_id=ti.id
		    WHERE documento = #{idcli};
	</select>
	
	<insert parameterType="map" id="agregarItemRentadoACliente">
		INSERT INTO VI_ITEMRENTADO (id,clientes_documento,items_id,fechainiciorenta,fechafinrenta)
		VALUES (#{idir},#{idcli},#{idit},#{fechainicio},#{fechafin});
	</insert>
	
	
	<resultMap type = 'Cliente' id = 'ClienteResult'>
		<id property = 'documento' column = 'documentoCliente'/>
		<result property = 'nombre' column = 'nombreCliente'/>
		<result property = 'telefono' column = 'telefonoCliente'/>
		<result property = 'direccion' column = 'direccionCliente'/>
		<result property = 'email' column = 'emailCliente'/>
		<result property = 'vetado' column = 'vetadoCliente'/>
		<collection property = 'rentados' ofType = 'ItemRentado' resultMap = 'edu.eci.cvds.sampleprj.dao.mybatis.mappers.ItemMapper.ItemResult'></collection>
	</resultMap>
	
	<resultMap type = 'ItemRentado' id = 'ItemRentadoResult'>
		<id property = 'id' column = 'idItemRentado'/>
		<result property = 'fechaInicioRenta' column = 'firItemRentado'/>
		<result property = 'fechaFinRenta' column = 'ffrItemRentado'/>
		<association property = 'item' javaType = 'Item' resultMap='edu.eci.cvds.sampleprj.dao.mybatis.mappers.ItemMapper.ItemResult'></association>
	</resultMap>
          	
</mapper>